# 大纲
## 技术赋能
- ### 基于mediapipe的特征点实现面部各部分的基础表情及特殊表情算法
    - 通过相机或者视频输入的纹理信息，经过**Mediapipe**引擎处理后输出478个**Landmarks**。为了能驱动人类虚拟模型的脸部表情通道**blendshapes**，必须通过一系列算法运算，把**Landmarks**转换为**blendshape**和头部**Rotation**.
    - 举个例子：为了使虚拟人物的表情更加逼真，我为模型的眼睛**blendshape**编写了眨眼函数，眼珠函数，分段函数，以及**biquad**二阶滤波器，以及lerp函数处理后输出低延迟，稳定可靠的**blendshape**值.
    - 遇到问题：模型的头部旋转坐标根据模型父节点的旋转，所以计算出得出头部旋转值不能简单应用到模型头部。
    - 解决方案：我为了使头部节点旋转正确，根据模型头部**localRotation**映射到**worldRotation**，本质上是头部矩阵与需要旋转矩阵相乘.

- ### MLive下载器   可实现多个模型文件同时下载，解决了弱网情况下保持继续下载,文件更新下载等的情况
    - 通过MLive下载框架，提供给**Zsta**和虚拟**3D**下载模型。分为配置层，下载层，缓存层， 业务层
        - 配置层：提供给下载器所需的固定参数，比如**URL**，客户端引擎版本**id**，客户端类型**id**，**MLive**缓存目录等等
        - 下载层：提供给下载器4个接口，比如**Task**返回值的下载封面文件，协程的下载模型文件，下载模型列表，下载模型地址。其中下载模型文件维护了缓存层的下载状态以及缓存层的后缀信息.
        - 缓存层：提供给下载器缓存和读取数据的接口。
    - 遇到问题：**UnityWebRequest API**有个大坑，弱网或者断网重连并且**timeout**未超时情况下，下载进度是会卡住，卡住后并且会使**timeout**无效，以至于不会抛出异常。
    - 解决方案：在这种情况下，需要定期检查下载的字节属性，并在一定时间内没有任何进展时自行中止**UnityWebRequest**.

- ### 自研面部兼容的数据解决方案专利
    - 驱动虚拟模型面部迁移，通过变换**Skinned Mesh Renderer**里的**BlendShapes**。市面上**3D**模型常用的2种**BlendShapes**协议分别是苹果公司的**ARkit**，和**vrm proxy**。鉴于**bs**协议上的不统一导致模型需要做两套的bs来适应。
    - 自研面部兼容的数据，兼容了**arkit**和**vrm proxy**，并且是相互转换，还能通过**bs**转换成特殊表情。
    - 遇到问题：**bs**推导特殊表情，推演更贴合的**bs**和其权重影响的特殊表情**bs**的相关因素。
    - 解决方案：记录移动端数据在**pc**端进行调试和测试，编写关于特殊表情与基准表情之间关系权重的可视化调试工具.

## 业务支持和保障
- ### 虚拟3d-pc端，ar头套-pc端面部迁移能力。
    - 对齐虚拟行业头部竞品面部技术，落地于虚拟产品里，接入**mediapipe**引擎，驱动面部包括（**vrm proxy，arkit，TV**协议）迁移.并实现面部校准，面部灵敏度调整等功能。
- ### 移动虚拟3D面部迁移能力。
    - CaptureFramework UPM（dev_3_0_0），最初是提供mediapipe等引擎的启动，暂停，恢复，更新，设置模型等接口。调整CaptureFramework UPM适配移动端，只提供了 Native Mediapipe Adaptor UPM，Native ARkit Adaptor UPM所需的数据和所需的接口能力，驱动层的能力属于业务放到项目里实现.新增泛型接口.
- ### 移动ar头套面部迁移能力。
    - #### 特殊表情推导
    - 能通过**bs**转换成特殊表情。
    - 遇到问题：**bs**推导特殊表情，推演更贴合的**bs**和其权重影响的特殊表情**bs**的相关因素。
    - 解决方案：记录移动端数据在**pc**端进行调试和测试，编写关于特殊表情与基准表情之间关系权重的可视化调试工具.
- ### 虚拟摄像头 借助github上一个开源库UnityCapture
    - **Unity Capture** 是一个 **Windows DirectShow** 过滤器，允许您将渲染的相机直接流式传输到另一个应用程序。更简单地说，它本质上是让 **Unity** 在 **Windows** 上模拟一个显示渲染相机的网络摄像头设备。
    - 它在中型 **PC** 上支持 60 **FPS** 的无延迟 1080**p**，并且可以在速度更快的 **PC** 上处理 4**K** 分辨率。它还支持在接收支持它的应用程序（如**OBS** ）时捕获多个摄像头和 **alpha** 通道（透明度）
- ### 优化CaptureFramework UPM，Mediapipe Adaptor UPM，Native Mediapipe Adaptor UPM
    - 高内聚低耦合，使代码更加高可用，易移植。
- ### 小K面部代码梳理，小K面部代码功能移植，XK UPM
    - 使现有的虚拟直播**3D-PC**端项目能使用小K面部的能力，对小K代码进行拆解，升级，修复和移植。

## 展望
- ### 自研面部算法
    - 展望：
        1. 从11个**bs**增加到52个**bs**，丰富虚拟人物表情
        2. 从低延时，低抖动的角度出发优化滤波器
- ### MLive下载器 
    - 展望：
        1. 可以实现**MLive**断点续传。
        2. 不止**MLive**后台，可以使其更加通用
- ### 自研面部兼容的数据解决方案专利
    - 展望：
        1. 可以和美术商量，定义一套公司自己的命名规范和美术标准的**bs**协议

## 规划



<!-- # 案例
## PC虚拟3D,PC AR头套
- ### 基于mediapipe的特征点实现面部各部分的基础表情及特殊表情算法
    - 通过相机或者视频输入的纹理信息，经过**Mediapipe**引擎处理后输出478个**Landmarks**。为了能驱动人类虚拟模型的脸部表情通道**blendshapes**，必须通过一系列算法运算，把**Landmarks**转换为**blendshape**和头部**Rotation**.
    - 举个例子：为了使虚拟人物的表情更加逼真，我为模型的眼睛**blendshape**编写了眨眼函数，眼珠函数，分段函数，以及**biquad**二阶滤波器，以及lerp函数处理后输出低延迟，稳定可靠的**blendshape**值.
    - 遇到问题：模型的头部旋转坐标根据模型父节点的旋转，所以计算出得出头部旋转值不能简单应用到模型头部。
    - 解决方案：我为了使头部节点旋转正确，根据模型头部**localRotation**映射到**worldRotation**，本质上是头部矩阵与需要旋转矩阵相乘.
    - 展望：
        1. 从11bs增加到52个bs，丰富虚拟人物表情
        2. 从低延时，低抖动的角度出发优化滤波器

- ### MLive下载器   可实现多个模型文件同时下载，解决了弱网情况下保持继续下载,文件更新下载等的情况
    - 通过MLive下载框架，提供给**Zsta**和虚拟**3D**下载模型。分为配置层，下载层，缓存层， 业务层
        - 配置层：提供给下载器所需的固定参数，比如**URL**，客户端引擎版本**id**，客户端类型**id**，**MLive**缓存目录等等
        - 下载层：提供给下载器4个接口，比如**Task**返回值的下载封面文件，协程的下载模型文件，下载模型列表，下载模型地址。其中下载模型文件维护了缓存层的下载状态以及缓存层的后缀信息.
        - 缓存层：提供给下载器缓存和读取数据的接口。
    - 遇到问题：**UnityWebRequest API**有个大坑，弱网或者断网重连并且**timeout**未超时情况下，下载进度是会卡住，卡住后并且会使**timeout**无效，以至于不会抛出异常。
    - 解决方案：在这种情况下，需要定期检查下载的字节属性，并在一定时间内没有任何进展时自行中止**UnityWebRequest**.
    - 展望：
        1. 可以实现MLive断点续传。
        2. 不止MLive后台，可以使其更加通用
- ### 自研面部兼容的数据解决方案专利
    - 驱动虚拟模型面部迁移，通过变换**Skinned Mesh Renderer**里的**BlendShapes**。市面上**3D**模型常用的2种**BlendShapes**协议分别是苹果公司的**ARkit**，和**vrm proxy**。鉴于**bs**协议上的不统一导致模型需要做两套的bs来适应。
    - 自研面部兼容的数据，兼容了**arkit**和**vrm proxy**，并且是相互转换，还能通过**Landmarks**计算出特殊表情**bs**
    - 展望：
        1. 可以和美术商量，定义一套自己命名规范和美术标准的bs协议
- ### 虚拟摄像头 借助github上一个开源库UnityCapture
    - **Unity Capture** 是一个 **Windows DirectShow** 过滤器，允许您将渲染的相机直接流式传输到另一个应用程序。更简单地说，它本质上是让 **Unity** 在 **Windows** 上模拟一个显示渲染相机的网络摄像头设备。
    - 它在中型 **PC** 上支持 60 **FPS** 的无延迟 1080**p**，并且可以在速度更快的 **PC** 上处理 4**K** 分辨率。它还支持在接收支持它的应用程序（如**OBS** ）时捕获多个摄像头和 **alpha** 通道（透明度）
- ### 优化CaptureFramework UPM，Mediapipe Adaptor UPM
    - 高内聚低耦合，使代码更加高可用，易移植。
- ### 小K面部代码梳理，小K面部代码功能移植，XK UPM
    - 使现有的虚拟直播**3D-PC**端项目能使用小K面部的能力，对小K代码进行拆解，升级，修复和移植。
---
## 移动虚拟3D
- ### Native Mediapipe Adaptor UPM，CaptureFramework UPM
    - 实现校准功能，自动眨眼功能
    - vrm模型驱动层接入
    - CaptureFramework UPM（dev_3_0_0），最初是提供mediapipe等引擎的启动，暂停，恢复，更新，设置模型等接口。调整CaptureFramework UPM，只提供了 Native Mediapipe Adaptor UPM，Native ARkit Adaptor UPM所需的数据和所需的接口能力，驱动层的能力属于业务放到项目里实现.新增泛型接口.
    - Native Mediapipe Adaptor UPM，在移动Android端提供了基于mediapipe引擎输入landmarks转换成blendshapes的能力.丰富面捕效果，增加眉毛blendshape推导
    - 优化眨眼函数，增加了低通滤波，调整滤波参数，明显降低了抖动频率
---
## 移动ar头套
- ### 特殊表情推导
    - 能通过**bs**转换成特殊表情。
    - 遇到问题：**bs**推导特殊表情，推演更贴合的**bs**和其权重影响的特殊表情**bs**的相关因素。
    - 解决方案：记录移动端数据在**pc**端进行调试和测试，编写关于特殊表情与基准表情之间关系权重的可视化调试工具. -->